"use strict";exports.id=240,exports.ids=[240],exports.modules={4240:(e,t,s)=>{s.d(t,{$R:()=>D});var n=s(1711),c=s(9089),a=s(7167),o=s(1312);const i=new Map,d="undefined"==typeof BroadcastChannel?class{constructor(e){this.room=e,this.onmessage=null,this._onChange=t=>t.key===e&&null!==this.onmessage&&this.onmessage({data:a.Ey(t.newValue||"")}),o.k9(this._onChange)}postMessage(e){o.JT.setItem(this.room,a.nk(a.zS(e)))}close(){o.o6(this._onChange)}}:BroadcastChannel,l=e=>n._4(i,e,(()=>{const t=c.vt(),s=new d(e);return s.onmessage=e=>t.forEach((t=>t(e.data,"broadcastchannel"))),{bc:s,subs:t}})),h=(e,t,s=null)=>{const n=l(e);n.bc.postMessage(t),n.subs.forEach((e=>e(t,s)))};var r=s(2132),u=s(1156),g=s(5968),w=s(2025);const p=(e,t)=>{u.zd(e,0);const s=w.FX(t);u.Gu(e,s)},m=(e,t,s)=>{u.zd(e,1),u.Gu(e,w.PR(t,s))},v=(e,t,s)=>{try{w.QE(t,g.bo(e),s)}catch(e){console.error("Caught error while handling a Yjs update",e)}},b=v;var f=s(3043),y=s(1116),_=s(8957);class I extends y.c{constructor(e){super(),this.doc=e,this.clientID=e.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval((()=>{const e=r._g();null!==this.getLocalState()&&15e3<=e-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());const t=[];this.meta.forEach(((s,n)=>{n!==this.clientID&&3e4<=e-s.lastUpdated&&this.states.has(n)&&t.push(n)})),t.length>0&&S(this,t,"timeout")}),f.RI(3e3)),e.on("destroy",(()=>{this.destroy()})),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(e){const t=this.clientID,s=this.meta.get(t),n=void 0===s?0:s.clock+1,c=this.states.get(t);null===e?this.states.delete(t):this.states.set(t,e),this.meta.set(t,{clock:n,lastUpdated:r._g()});const a=[],o=[],i=[],d=[];null===e?d.push(t):null==c?null!=e&&a.push(t):(o.push(t),_.vo(c,e)||i.push(t)),(a.length>0||i.length>0||d.length>0)&&this.emit("change",[{added:a,updated:i,removed:d},"local"]),this.emit("update",[{added:a,updated:o,removed:d},"local"])}setLocalStateField(e,t){const s=this.getLocalState();null!==s&&this.setLocalState({...s,[e]:t})}getStates(){return this.states}}const S=(e,t,s)=>{const n=[];for(let s=0;s<t.length;s++){const c=t[s];if(e.states.has(c)){if(e.states.delete(c),c===e.clientID){const t=e.meta.get(c);e.meta.set(c,{clock:t.clock+1,lastUpdated:r._g()})}n.push(c)}}n.length>0&&(e.emit("change",[{added:[],updated:[],removed:n},s]),e.emit("update",[{added:[],updated:[],removed:n},s]))},k=(e,t,s=e.states)=>{const n=t.length,c=u.xv();u.zd(c,n);for(let a=0;a<n;a++){const n=t[a],o=s.get(n)||null,i=e.meta.get(n).clock;u.zd(c,n),u.zd(c,i),u.Qj(c,JSON.stringify(o))}return u.Fo(c)};var x=s(7294),C=s(5671);const z=[];z[0]=(e,t,s,n,c)=>{u.zd(e,0);const a=((e,t,s,n)=>{const c=g.cw(e);switch(c){case 0:((e,t,s)=>{m(t,s,g.bo(e))})(e,t,s);break;case 1:v(e,s,n);break;case 2:b(e,s,n);break;default:throw new Error("Unknown message type")}return c})(t,e,s.doc,s);n&&1===a&&!s.synced&&(s.synced=!0)},z[3]=(e,t,s,n,c)=>{u.zd(e,1),u.Gu(e,k(s.awareness,Array.from(s.awareness.getStates().keys())))},z[1]=(e,t,s,n,c)=>{((e,t,s)=>{const n=g.$C(t),c=r._g(),a=[],o=[],i=[],d=[],l=g.cw(n);for(let t=0;t<l;t++){const t=g.cw(n);let s=g.cw(n);const l=JSON.parse(g.t3(n)),h=e.meta.get(t),r=e.states.get(t),u=void 0===h?0:h.clock;(u<s||u===s&&null===l&&e.states.has(t))&&(null===l?t===e.clientID&&null!=e.getLocalState()?s++:e.states.delete(t):e.states.set(t,l),e.meta.set(t,{clock:s,lastUpdated:c}),void 0===h&&null!==l?a.push(t):void 0!==h&&null===l?d.push(t):null!==l&&(_.vo(l,r)||i.push(t),o.push(t)))}(a.length>0||i.length>0||d.length>0)&&e.emit("change",[{added:a,updated:i,removed:d},s]),(a.length>0||o.length>0||d.length>0)&&e.emit("update",[{added:a,updated:o,removed:d},s])})(s.awareness,g.bo(t),s)},z[2]=(e,t,s,n,c)=>{((e,t,s)=>{0===g.cw(e)&&s(0,g.t3(e))})(t,s.doc,((e,t)=>U(s,t)))};const U=(e,t)=>console.warn(`Permission denied to access ${e.url}.\n${t}`),L=(e,t,s)=>{const n=g.$C(t),c=u.xv(),a=g.cw(n),o=e.messageHandlers[a];return o?o(c,n,e,s,a):console.error("Unable to compute message"),c},F=e=>{if(e.shouldConnect&&null===e.ws){const t=new e._WS(e.url,e.protocols);t.binaryType="arraybuffer",e.ws=t,e.wsconnecting=!0,e.wsconnected=!1,e.synced=!1,t.onmessage=s=>{e.wsLastMessageReceived=r._g();const n=L(e,new Uint8Array(s.data),!0);u.Bw(n)>1&&t.send(u.Fo(n))},t.onerror=t=>{e.emit("connection-error",[t,e])},t.onclose=t=>{e.emit("connection-close",[t,e]),e.ws=null,e.wsconnecting=!1,e.wsconnected?(e.wsconnected=!1,e.synced=!1,S(e.awareness,Array.from(e.awareness.getStates().keys()).filter((t=>t!==e.doc.clientID)),e),e.emit("status",[{status:"disconnected"}])):e.wsUnsuccessfulReconnects++,setTimeout(F,f.jk(100*f.n7(2,e.wsUnsuccessfulReconnects),e.maxBackoffTime),e)},t.onopen=()=>{e.wsLastMessageReceived=r._g(),e.wsconnecting=!1,e.wsconnected=!0,e.wsUnsuccessfulReconnects=0,e.emit("status",[{status:"connected"}]);const s=u.xv();if(u.zd(s,0),p(s,e.doc),t.send(u.Fo(s)),null!==e.awareness.getLocalState()){const s=u.xv();u.zd(s,1),u.Gu(s,k(e.awareness,[e.doc.clientID])),t.send(u.Fo(s))}},e.emit("status",[{status:"connecting"}])}},B=(e,t)=>{const s=e.ws;e.wsconnected&&s&&s.readyState===s.OPEN&&s.send(t),e.bcconnected&&h(e.bcChannel,t,e)};class D extends y.c{constructor(e,t,s,{connect:n=!0,awareness:c=new I(s),params:a={},protocols:o=[],WebSocketPolyfill:i=WebSocket,resyncInterval:d=-1,maxBackoffTime:l=2500,disableBc:g=!1}={}){for(super();"/"===e[e.length-1];)e=e.slice(0,e.length-1);this.serverUrl=e,this.bcChannel=e+"/"+t,this.maxBackoffTime=l,this.params=a,this.protocols=o,this.roomname=t,this.doc=s,this._WS=i,this.awareness=c,this.wsconnected=!1,this.wsconnecting=!1,this.bcconnected=!1,this.disableBc=g,this.wsUnsuccessfulReconnects=0,this.messageHandlers=z.slice(),this._synced=!1,this.ws=null,this.wsLastMessageReceived=0,this.shouldConnect=n,this._resyncInterval=0,d>0&&(this._resyncInterval=setInterval((()=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN){const e=u.xv();u.zd(e,0),p(e,s),this.ws.send(u.Fo(e))}}),d)),this._bcSubscriber=(e,t)=>{if(t!==this){const t=L(this,new Uint8Array(e),!1);u.Bw(t)>1&&h(this.bcChannel,u.Fo(t),this)}},this._updateHandler=(e,t)=>{if(t!==this){const t=u.xv();u.zd(t,0),((e,t)=>{u.zd(e,2),u.Gu(e,t)})(t,e),B(this,u.Fo(t))}},this.doc.on("update",this._updateHandler),this._awarenessUpdateHandler=({added:e,updated:t,removed:s},n)=>{const a=e.concat(t).concat(s),o=u.xv();u.zd(o,1),u.Gu(o,k(c,a)),B(this,u.Fo(o))},this._exitHandler=()=>{S(this.awareness,[s.clientID],"app closed")},C.Ll&&"undefined"!=typeof process&&process.on("exit",this._exitHandler),c.on("update",this._awarenessUpdateHandler),this._checkInterval=setInterval((()=>{this.wsconnected&&3e4<r._g()-this.wsLastMessageReceived&&this.ws.close()}),3e3),n&&this.connect()}get url(){const e=(t=this.params,x.Tj(t,((e,t)=>`${encodeURIComponent(t)}=${encodeURIComponent(e)}`)).join("&"));var t;return this.serverUrl+"/"+this.roomname+(0===e.length?"":"?"+e)}get synced(){return this._synced}set synced(e){this._synced!==e&&(this._synced=e,this.emit("synced",[e]),this.emit("sync",[e]))}destroy(){0!==this._resyncInterval&&clearInterval(this._resyncInterval),clearInterval(this._checkInterval),this.disconnect(),C.Ll&&"undefined"!=typeof process&&process.off("exit",this._exitHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.doc.off("update",this._updateHandler),super.destroy()}connectBc(){if(this.disableBc)return;var e,t;this.bcconnected||(e=this.bcChannel,t=this._bcSubscriber,l(e).subs.add(t),this.bcconnected=!0);const s=u.xv();u.zd(s,0),p(s,this.doc),h(this.bcChannel,u.Fo(s),this);const n=u.xv();u.zd(n,0),m(n,this.doc),h(this.bcChannel,u.Fo(n),this);const c=u.xv();u.zd(c,3),h(this.bcChannel,u.Fo(c),this);const a=u.xv();u.zd(a,1),u.Gu(a,k(this.awareness,[this.doc.clientID])),h(this.bcChannel,u.Fo(a),this)}disconnectBc(){const e=u.xv();u.zd(e,1),u.Gu(e,k(this.awareness,[this.doc.clientID],new Map)),B(this,u.Fo(e)),this.bcconnected&&(((e,t)=>{const s=l(e);s.subs.delete(t)&&0===s.subs.size&&(s.bc.close(),i.delete(e))})(this.bcChannel,this._bcSubscriber),this.bcconnected=!1)}disconnect(){this.shouldConnect=!1,this.disconnectBc(),null!==this.ws&&this.ws.close()}connect(){this.shouldConnect=!0,this.wsconnected||null!==this.ws||(F(this),this.connectBc())}}}};